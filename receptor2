#include <esp_now.h>
#include <WiFi.h>
#include "esp_wifi.h"

typedef struct struct_mensaje {
  int id;
  int valorPotenciometro;  // ahora se recibe este dato
} struct_mensaje;

struct_mensaje datoEntrante;

const int umbralCambio = 10;  // Solo imprimir si cambia al menos 10 unidades
int ultimoValor = -1;

void onDataRecv(const esp_now_recv_info_t *info, const uint8_t *data, int len) {
  struct_mensaje nuevoDato;
  memcpy(&nuevoDato, data, sizeof(nuevoDato));

  if (abs(nuevoDato.valorPotenciometro - ultimoValor) >= umbralCambio) {
    Serial.print("ID: ");
    Serial.println(nuevoDato.id);
    Serial.print("Valor Potenciómetro: ");
    Serial.println(nuevoDato.valorPotenciometro);
    ultimoValor = nuevoDato.valorPotenciometro;
  }
}

void setup() {
  Serial.begin(115200);

  // Modo estación
  WiFi.mode(WIFI_STA);
  esp_wifi_set_channel(1, WIFI_SECOND_CHAN_NONE);

  // Iniciar ESP-NOW
  if (esp_now_init() != ESP_OK) {
    Serial.println("Error al inicializar ESP-NOW");
    return;
  }

  // Registrar callback
  esp_now_register_recv_cb(onDataRecv);
}

void loop() {
  // No es necesario nada aquí
}
